# 医生报表统计

本金赠金都统计

**预约人数=已预约人数** : 监听 registration_info 预约签到表

**到店人数=签到人数**：监听 registration_info 预约签到表

**接诊人数=点击接诊的人数 **：监听medical_info 门诊表

**执行人数=执行人选择医生的人数**：

监听 execute_record表，并关联  execute_record_item、tp_record_item_employee表

**收费总额=接诊后收费产生的费用总计(开单出的金额)**：监听`charge_action`收费操作表



# 理疗师工作量统计

执行次数、撤销次数、执行金额、撤销金额：监听 execute_record表，并关联  execute_record_item、tp_record_item_employee、charge_action表



建表及查询SQL如下：

```

# 医生收费总额
drop table if exists zs_data.dw_doctor_workload_day;
create table zs_data.dw_doctor_workload_day
(
    id                          bigint unsigned auto_increment comment 'ID'
        primary key,
    charge_action_id            bigint         default -1                not null comment '收费单id',
    registration_info_id        bigint         default -1                not null comment '挂号预约id',
    medical_info_id             bigint         default -1                not null comment '门诊id',
    execute_info_id             bigint         default -1                not null comment '执行信息ID',
    tp_record_item_employee_id  bigint         default -1                not null comment '执行项目执行人关联表id',
    doctor_id                   bigint         default -1                not null comment '医生ID',
    doctor_name                 varchar(10)    default ''                not null comment '医生姓名',
    patient_id                  bigint         default -1                not null comment '患者id',
    patient_name                varchar(64)    default ''                null comment '患者名',
    number_of_appointments      int            default 0                 not null comment '预约人数',
    store_attendance            int            default 0                 not null comment '到店人数',
    number_of_patients_received int            default 0                 not null comment '接诊人数',
    number_of_implementers      int            default 0                 not null comment '执行人数',
    amount                      decimal(32, 8) default 0.00000000        not null comment '收费金额',
    created_date                date           default '1970-01-01'      not null comment '创建日期',
    tenant_id                   bigint                                   null comment '租户ID',
    created_by                  bigint                                   null comment '创建人ID',
    created_time                datetime       default CURRENT_TIMESTAMP not null comment '创建时间',
    updated_by                  bigint                                   null comment '更新人ID',
    updated_time                datetime       default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间',
    is_del                      bit            default b'0'              not null comment '是否删除'
)
    comment '门店医生工作量统计';
    
select doctor_id,
       doctor_name,
       sum(number_of_appointments),
       sum(store_attendance),
       sum(number_of_patients_received),
       sum(number_of_implementers),
       sum(amount),
       DATE_FORMAT(created_date, '%Y-%m-%d') as created_date,
       tenant_id
from dw_doctor_workload_day
where doctor_id = if('${doctorId}' > 0, '${doctorId}', doctor_id)
  and doctor_id != -1
  and tenant_id in (16)
  and created_date BETWEEN '2021-01-01' AND '2023-01-01'

# 理疗师工作量统计
-- auto-generated definition
drop table if exists zs_data.dw_physiotherapist_day;
create table zs_data.dw_physiotherapist_day
(
    id                         bigint unsigned auto_increment comment 'ID'
        primary key,
    charge_action_id           bigint         default -1                not null comment '收费单id',
    execute_info_id            bigint         default -1                not null comment '执行信息ID',
    tp_record_item_employee_id bigint         default -1                not null comment '执行项目执行人关联表id',
    doctor_id                  bigint         default -1                not null comment '理疗师ID',
    doctor_name                varchar(10)    default ''                not null comment '理疗师姓名',
    number_of_executions       int            default 0                 not null comment '执行次数',
    number_of_cancellations    int            default 0                 not null comment '撤销次数',
    execute_amount             decimal(32, 8) default 0.00000000        not null comment '执行金额',
    revocation_amount          decimal(32, 8) default 0.00000000        not null comment '撤销金额',
    created_date               date           default '1970-01-01'      not null comment '创建日期',
    tenant_id                  bigint                                   null comment '租户ID',
    created_by                 bigint                                   null comment '创建人ID',
    created_time               datetime       default CURRENT_TIMESTAMP not null comment '创建时间',
    updated_by                 bigint                                   null comment '更新人ID',
    updated_time               datetime       default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间',
    is_del                     bit            default b'0'              not null comment '是否删除'
)
    comment '理疗师工作量统计';


select doctor_id,
       doctor_name,
       sum(number_of_executions)             as number_of_executions,
       sum(number_of_cancellations)          as number_of_cancellations,
       sum(execute_amount)                   as execute_amount,
       sum(revocation_amount)                as revocation_amount,
       DATE_FORMAT(created_date, '%Y-%m-%d') as created_date,
       tenant_id
from dw_physiotherapist_day
where doctor_id = if('${doctorId}' > 0, '${doctorId}', doctor_id)
  and tenant_id in (${tenantId})
  and doctor_id != -1
group by doctor_id, doctor_name, created_date, tenant_id;

```

